{% extends "base.html" %}

{% block content %}
<h2>üé§ –†–∞—Å—à–∏—Ñ—Ä–æ–≤–∫–∞ –∞—É–¥–∏–æ</h2>

<form id="transcribe-form" action="{{ url_for('transcribator.handle_transcription') }}" method="post" enctype="multipart/form-data">

    <div class="drop-zone" id="drop-zone">
        <div class="icon">üìÅ</div>
        <p>–ü–µ—Ä–µ—Ç–∞—â–∏—Ç–µ –∞—É–¥–∏–æ—Ñ–∞–π–ª —Å—é–¥–∞</p>
        <p>–∏–ª–∏</p>
        <label class="custom-file-upload">
            <input type="file" id="audio-file" name="audio" accept="audio/*" required />
            –í—ã–±—Ä–∞—Ç—å —Ñ–∞–π–ª –≤—Ä—É—á–Ω—É—é
        </label>
    </div>
    <span id="file-name" class="file-name"></span>

    <div class="download-option">
        <label>
            <input type="checkbox" name="download" />
            –°–∫–∞—á–∞—Ç—å —Ä–µ–∑—É–ª—å—Ç–∞—Ç —Å—Ä–∞–∑—É –ø–æ—Å–ª–µ —Ç—Ä–∞–Ω—Å–∫—Ä–∏–ø—Ü–∏–∏
        </label>
    </div>

    <div class="venue-selector">
        <select name="venue_id" id="venue">
            <option value="">-- –í—ã–±—Ä–∞—Ç—å –ø–ª–æ—â–∞–¥–∫—É --</option>
            {% for venue in venues %}
            <option value="{{ venue.id }}">{{ venue.name }}</option>
            {% endfor %}
        </select>
    </div>
    <div class="venue-selector">
        <select name="day_id" id="day">
            <option value="">-- –í—ã–±—Ä–∞—Ç—å –¥–∞—Ç—É --</option>
            {% for day in days %}
            <option value="{{ day.id }}">{{ day.name }}</option>
            {% endfor %}
        </select>
    </div>

    <input type="submit" value="–û—Ç–ø—Ä–∞–≤–∏—Ç—å" />
</form>

<a href="{{ url_for('transcribator.history') }}" class="history-link">üìú –ü–æ—Å–º–æ—Ç—Ä–µ—Ç—å –∏—Å—Ç–æ—Ä–∏—é —Ç—Ä–∞–Ω—Å–∫—Ä–∏–ø—Ü–∏–π</a>

<script>
    const dropZone = document.getElementById('drop-zone');
    const fileInput = document.getElementById('audio-file');
    const fileNameSpan = document.getElementById('file-name');

    fileInput.addEventListener('change', function() {
        updateFileName(this.files);
    });

    ['dragenter', 'dragover', 'dragleave', 'drop'].forEach(eventName => {
        dropZone.addEventListener(eventName, preventDefaults, false);
    });

    function preventDefaults(e) {
        e.preventDefault();
        e.stopPropagation();
    }

    ['dragenter', 'dragover'].forEach(eventName => {
        dropZone.addEventListener(eventName, highlight, false);
    });

    ['dragleave', 'drop'].forEach(eventName => {
        dropZone.addEventListener(eventName, unhighlight, false);
    });

    function highlight() {
        dropZone.classList.add('active');
    }

    function unhighlight() {
        dropZone.classList.remove('active');
    }

    dropZone.addEventListener('drop', handleDrop, false);

    function handleDrop(e) {
        const dt = e.dataTransfer;
        const files = dt.files;
        fileInput.files = files; // –ü—Ä–∏–≤—è–∑—ã–≤–∞–µ–º —Ñ–∞–π–ª—ã –∫ input
        updateFileName(files);
    }

    function updateFileName(files) {
        if (files.length > 0) {
            fileNameSpan.textContent = files[0].name;
        } else {
            fileNameSpan.textContent = '';
        }
    }

    const form = document.getElementById('transcribe-form');
    form.addEventListener('submit', function() {
        const submitBtn = form.querySelector('input[type="submit"]');
        submitBtn.disabled = true;
    });
</script>
{% endblock %}
