{% extends "base.html" %}
{% block content %}
<h2>Индивидуальная оценка</h2>
<form method="post" action="{{ url_for('indiv_eval.save') }}" class="form-grid">

  <!-- Блок работ -->
  <div class="form-row">
    <label>Блок работ</label>
    <select name="block_id" id="block_id" class="select2" required>
      <option value="" selected>Все блоки</option>
      {% for b in blocks %}
        <option value="{{ b.id }}">{{ b.name }}</option>
      {% endfor %}
    </select>
  </div>

  <div class="form-row">
  <label>ФИО</label>
  <select name="participant_id" id="participant_id" class="select2">
    <option value="" selected>Все участники</option>
    {% for p in participants %}
      <option value="{{ p.id }}" 
              data-team="{{ p.team_id }}" 
              data-case="{{ p.team.case_id if p.team and p.team.case_id else '' }}">
        {{ p.full_name }}
      </option>
    {% endfor %}
  </select>
</div>

  <!-- Команда -->
  <div class="form-row">
    <label>Команда</label>
    <select name="team_id" id="team_id" class="select2">
      <option value="" selected>Все команды</option>
      {% for t in teams %}
        <option value="{{ t.id }}">{{ t.name }}</option>
      {% endfor %}
    </select>
  </div>

  <!-- Кейс -->
  <div class="form-row">
    <label>Кейс</label>
    <select name="case_id" id="case_id" class="select2">
      <option value="" selected>Все кейсы</option>
      {% for c in cases %}
        <option value="{{ c.id }}" data-team="{{ c.team_id }}">{{ c.title }}</option>
      {% endfor %}
    </select>
  </div>

  <!-- ФИО
  <div class="form-row">
    <label>ФИО</label>
    <select name="participant_id" id="participant_id" class="select2">
      <option value="" selected>Все участники</option>
      {% for p in participants %}
        <option value="{{ p.id }}" data-team="{{ p.team_id }}">{{ p.full_name }}</option>
      {% endfor %}
    </select>
  </div> -->

  <!-- Оценка -->
  <div class="form-row">
    <label>Оценка</label>
    <input type="number" name="score" min="0" max="100" step="0.01" required>
  </div>

  <!-- Комментарии -->
  <div class="form-row">
    <label>Комментарии</label>
    <textarea name="comment" rows="3" placeholder="Трекер, эксперт..."></textarea>
  </div>

  <div class="form-actions">
    <button type="submit">Сохранить</button>
  </div>
</form>

<script>
$(function() {
  $(".select2").select2({ width: '100%', placeholder: 'Выберите...', allowClear: true });

  // Участник → команда + кейс
  $("#participant_id").on("change", function() {
    let selected = $(this).find("option:selected");
    let teamId = selected.data("team");
    let caseId = selected.data("case");

    if (teamId) {
      $("#team_id").val(teamId).trigger("change.select2");
    }
    if (caseId) {
      $("#case_id").val(caseId).trigger("change.select2");
    }
  });
});
</script>



{% endblock %}
